
resources:
  containers:
  - container: crops_poky
    image: 'auto3000/poky'
    env:
      LC_ALL: en_US.UTF-8
      LANG: en_US.UTF-8


.yocto_steps: &yocto_steps
  - script: |
      source init.sh $TARGET
      echo 'SCONF_VERSION = "1"' > conf/site.conf
      echo 'SSTATE_DIR ?= "/tmp/sstate-cache"' >> conf/site.conf
      echo 'DL_DIR ?= "/tmp/downloads"' >> conf/site.conf
      bitbake pedalpi-dev-platform

jobs:
- job: build-nanopi-neo-air
  displayName: 'Run a multi-line script'
  timeoutInMinutes: 0
  pool:
    vmImage: 'ubuntu-16.04'
  container: crops_poky
  env:
    TARGET: nanopi-neo-air
  steps:
    <<: *yocto_steps
- job: build-qemux86-64
  displayName: 'Run a multi-line script'
  timeoutInMinutes: 0
  pool:
    vmImage: 'ubuntu-16.04'
  container: crops_poky
  env:
    TARGET: qemux86-64
  steps:
    <<: *yocto_steps
- job: build-raspberrypi2
  displayName: 'Run a multi-line script'
  timeoutInMinutes: 0
  pool:
    vmImage: 'ubuntu-16.04'
  container: crops_poky
  env:
    TARGET: raspberrypi2
  steps:
    <<: *yocto_steps
- job: build-raspberrypi3
  displayName: 'Run a multi-line script'
  timeoutInMinutes: 0
  pool:
    vmImage: 'ubuntu-16.04'
  container: crops_poky
  env:
    TARGET: raspberrypi3
  steps:
    <<: *yocto_steps
- job: B
  dependsOn: build-nanopi-neo-air
  steps:
    - script: echo hello from B


